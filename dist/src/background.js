(function(){"use strict";const t={ENABLED:"crtEnabled",SCANLINE:"scanlineIntensity",VIGNETTE:"vignetteIntensity",CURVATURE:"curvatureIntensity",GLOW:"glowIntensity",SOUND_FILTER:"soundFilterEnabled",SOUND_EFFECT_LEVEL:"soundEffectLevel",SOUND_NOISE_LEVEL:"soundNoiseLevel",VHS_GLITCHES:"vhsGlitchesEnabled",GLITCH_PHASE_LEVEL:"glitchPhaseLevel",GLITCH_NOISE_LEVEL:"glitchNoiseLevel"},a={[t.ENABLED]:!1,[t.SCANLINE]:.4,[t.VIGNETTE]:.5,[t.CURVATURE]:.15,[t.GLOW]:.1,[t.SOUND_FILTER]:!1,[t.SOUND_EFFECT_LEVEL]:.8,[t.SOUND_NOISE_LEVEL]:.6,[t.VHS_GLITCHES]:!1,[t.GLITCH_PHASE_LEVEL]:.3,[t.GLITCH_NOISE_LEVEL]:.15},o={TOGGLE:"toggle"},c=["chrome://","chrome-extension://","edge://"];function l(s){return s.id&&s.url&&!c.some(e=>s.url.startsWith(e))}const n={get(s,e){chrome.storage.local.get(s,e)},set(s,e){chrome.storage.local.set(s,e??(()=>{}))}},r={sendToMessageableTabs(s,e){chrome.tabs.query({},E=>{E.filter(l).forEach(u=>{chrome.tabs.sendMessage(u.id,s).then(()=>e==null?void 0:e()).catch(d=>e==null?void 0:e(d))})})}};function L(){var s,e;try{const E=(e=(s=chrome==null?void 0:chrome.runtime)==null?void 0:s.getManifest)==null?void 0:e.call(s);return!(E!=null&&E.update_url)}catch{return!1}}function i(s,e){L()&&(e!=null?console.warn(`[CRT Overlay] ${s}`,e):console.warn(`[CRT Overlay] ${s}`))}const g="toggle-crt";function T(s){r.sendToMessageableTabs({type:o.TOGGLE,enabled:s},e=>{e&&(e.message&&e.message.includes("Receiving end does not exist")||i("Background: sendMessage to tab failed",e))})}chrome.runtime.onInstalled.addListener(()=>{n.get(null,s=>{const e={...a};Object.keys(e).forEach(E=>{s[E]!==void 0&&(e[E]=s[E])}),n.set(e)})}),chrome.commands.onCommand.addListener(s=>{s===g&&n.get(t.ENABLED,e=>{const E=!e[t.ENABLED];n.set({[t.ENABLED]:E},()=>{T(E)})})})})();
