(function(){"use strict";const i=[{name:"ENABLED",key:"crtEnabled",default:!1,type:"checkbox",popupId:"crt-enabled",contentKey:null},{name:"SOUND_FILTER",key:"soundFilterEnabled",default:!1,type:"checkbox",popupId:"crt-sound-filter",contentKey:"soundFilter"},{name:"SOUND_EFFECT_LEVEL",key:"soundEffectLevel",default:.8,type:"slider",popupId:"sound-effect-level",fillId:"sound-effect-fill",min:0,max:1},{name:"SOUND_NOISE_LEVEL",key:"soundNoiseLevel",default:.6,type:"slider",popupId:"sound-noise-level",fillId:"sound-noise-fill",min:0,max:1},{name:"SOUND_OVERRIDE_LEVEL",key:"soundOverdriveLevel",default:0,type:"slider",popupId:"sound-overdrive-level",fillId:"sound-overdrive-fill",min:0,max:1},{name:"SOUND_CHORUS_LEVEL",key:"soundChorusLevel",default:0,type:"slider",popupId:"sound-chorus-level",fillId:"sound-chorus-fill",min:0,max:1},{name:"VHS_GLITCHES",key:"vhsGlitchesEnabled",default:!1,type:"checkbox",popupId:"crt-vhs-glitches",contentKey:"vhsGlitches"},{name:"GLITCH_PHASE_LEVEL",key:"glitchPhaseLevel",default:.3,type:"slider",popupId:"glitch-phase-level",fillId:"glitch-phase-fill",min:0,max:1},{name:"GLITCH_NOISE_LEVEL",key:"glitchNoiseLevel",default:.15,type:"slider",popupId:"glitch-noise-level",fillId:"glitch-noise-fill",min:0,max:1},{name:"GLITCH_TRACKING_LEVEL",key:"glitchTrackingLevel",default:.5,type:"slider",popupId:"glitch-tracking-level",fillId:"glitch-tracking-fill",min:0,max:1},{name:"GLITCH_WOBBLE_LEVEL",key:"glitchWobbleLevel",default:.3,type:"slider",popupId:"glitch-wobble-level",fillId:"glitch-wobble-fill",min:0,max:1},{name:"GLITCH_HEADSWITCH_LEVEL",key:"glitchHeadswitchLevel",default:.25,type:"slider",popupId:"glitch-headswitch-level",fillId:"glitch-headswitch-fill",min:0,max:1},{name:"GLITCH_RGB_LEVEL",key:"glitchRgbLevel",default:.35,type:"slider",popupId:"glitch-rgb-level",fillId:"glitch-rgb-fill",min:0,max:1},{name:"GLITCH_DROPOUT_LEVEL",key:"glitchDropoutLevel",default:.2,type:"slider",popupId:"glitch-dropout-level",fillId:"glitch-dropout-fill",min:0,max:1},{name:"GLITCH_REWIND_LEVEL",key:"glitchRewindLevel",default:.4,type:"slider",popupId:"glitch-rewind-level",fillId:"glitch-rewind-fill",min:0,max:1},{name:"SCANLINE",key:"scanlineIntensity",default:.4,type:"slider",popupId:"scanline",fillId:"scanline-fill",min:0,max:1,optionName:"scanline"},{name:"VIGNETTE",key:"vignetteIntensity",default:.5,type:"slider",popupId:"vignette",fillId:"vignette-fill",min:0,max:1,optionName:"vignette"},{name:"GLOW",key:"glowIntensity",default:.15,type:"slider",popupId:"glow",fillId:"glow-fill",min:0,max:.8,optionName:"glow"}],s=Object.fromEntries(i.map(e=>[e.name,e.key])),a=Object.fromEntries(i.map(e=>[e.key,e.default]));i.map(e=>e.key);const o=i.filter(e=>e.type==="slider");i.filter(e=>e.optionName).map(e=>e.key),Object.fromEntries(i.filter(e=>e.optionName).map(e=>[e.key,e.optionName])),Object.fromEntries(i.filter(e=>e.optionName).map(e=>[e.optionName,e.key])),Object.fromEntries(i.filter(e=>e.popupId).map(e=>[e.name,e.popupId])),Object.fromEntries(o.map(e=>[e.popupId,{min:e.min,max:e.max}])),Object.fromEntries(i.filter(e=>e.fillId).map(e=>[e.popupId,e.fillId])),Object.fromEntries(o.map(e=>[e.popupId,e.key]));const d={TOGGLE:"toggle"},p=["chrome://","chrome-extension://","edge://"];function c(e){return e.id&&e.url&&!p.some(l=>e.url.startsWith(l))}const n={get(e,l){chrome.storage.local.get(e,l)},set(e,l){chrome.storage.local.set(e,l??(()=>{}))}},r={sendToMessageableTabs(e,l){chrome.tabs.query({},t=>{t.filter(c).forEach(I=>{chrome.tabs.sendMessage(I.id,e).then(()=>l==null?void 0:l()).catch(g=>l==null?void 0:l(g))})})}};function m(){var e,l;try{const t=(l=(e=chrome==null?void 0:chrome.runtime)==null?void 0:e.getManifest)==null?void 0:l.call(e);return!(t!=null&&t.update_url)}catch{return!1}}function f(e,l){m()&&(l!=null?console.warn(`[CRT Overlay] ${e}`,l):console.warn(`[CRT Overlay] ${e}`))}const u="toggle-crt";function E(e){r.sendToMessageableTabs({type:d.TOGGLE,enabled:e},l=>{l&&(l.message&&l.message.includes("Receiving end does not exist")||f("Background: sendMessage to tab failed",l))})}chrome.runtime.onInstalled.addListener(()=>{n.get(null,e=>{const l={...a};Object.keys(l).forEach(t=>{e[t]!==void 0&&(l[t]=e[t])}),n.set(l)})}),chrome.commands.onCommand.addListener(e=>{e===u&&n.get(s.ENABLED,l=>{const t=!l[s.ENABLED];n.set({[s.ENABLED]:t},()=>{E(t)})})})})();
