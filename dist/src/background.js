(function(){"use strict";const s={ENABLED:"crtEnabled",SCANLINE:"scanlineIntensity",VIGNETTE:"vignetteIntensity",GLOW:"glowIntensity",SOUND_FILTER:"soundFilterEnabled",SOUND_EFFECT_LEVEL:"soundEffectLevel",SOUND_NOISE_LEVEL:"soundNoiseLevel",VHS_GLITCHES:"vhsGlitchesEnabled",GLITCH_PHASE_LEVEL:"glitchPhaseLevel",GLITCH_NOISE_LEVEL:"glitchNoiseLevel",GLITCH_TRACKING_LEVEL:"glitchTrackingLevel",GLITCH_WOBBLE_LEVEL:"glitchWobbleLevel",GLITCH_HEADSWITCH_LEVEL:"glitchHeadswitchLevel",GLITCH_RGB_LEVEL:"glitchRgbLevel",GLITCH_DROPOUT_LEVEL:"glitchDropoutLevel"},n={[s.ENABLED]:!1,[s.SCANLINE]:.4,[s.VIGNETTE]:.5,[s.GLOW]:.15,[s.SOUND_FILTER]:!1,[s.SOUND_EFFECT_LEVEL]:.8,[s.SOUND_NOISE_LEVEL]:.6,[s.VHS_GLITCHES]:!1,[s.GLITCH_PHASE_LEVEL]:.3,[s.GLITCH_NOISE_LEVEL]:.15,[s.GLITCH_TRACKING_LEVEL]:.5,[s.GLITCH_WOBBLE_LEVEL]:.3,[s.GLITCH_HEADSWITCH_LEVEL]:.25,[s.GLITCH_RGB_LEVEL]:.35,[s.GLITCH_DROPOUT_LEVEL]:.2},l={TOGGLE:"toggle"},c=["chrome://","chrome-extension://","edge://"];function o(E){return E.id&&E.url&&!c.some(e=>E.url.startsWith(e))}const t={get(E,e){chrome.storage.local.get(E,e)},set(E,e){chrome.storage.local.set(E,e??(()=>{}))}},a={sendToMessageableTabs(E,e){chrome.tabs.query({},L=>{L.filter(o).forEach(g=>{chrome.tabs.sendMessage(g.id,E).then(()=>e==null?void 0:e()).catch(I=>e==null?void 0:e(I))})})}};function i(){var E,e;try{const L=(e=(E=chrome==null?void 0:chrome.runtime)==null?void 0:E.getManifest)==null?void 0:e.call(E);return!(L!=null&&L.update_url)}catch{return!1}}function T(E,e){i()&&(e!=null?console.warn(`[CRT Overlay] ${E}`,e):console.warn(`[CRT Overlay] ${E}`))}const _="toggle-crt";function r(E){a.sendToMessageableTabs({type:l.TOGGLE,enabled:E},e=>{e&&(e.message&&e.message.includes("Receiving end does not exist")||T("Background: sendMessage to tab failed",e))})}chrome.runtime.onInstalled.addListener(()=>{t.get(null,E=>{const e={...n};Object.keys(e).forEach(L=>{E[L]!==void 0&&(e[L]=E[L])}),t.set(e)})}),chrome.commands.onCommand.addListener(E=>{E===_&&t.get(s.ENABLED,e=>{const L=!e[s.ENABLED];t.set({[s.ENABLED]:L},()=>{r(L)})})})})();
