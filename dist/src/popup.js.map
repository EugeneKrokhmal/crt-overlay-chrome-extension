{"version":3,"file":"popup.js","sources":["../../src/shared/config.js","../../src/shared/chrome-facade.js","../../src/shared/logger.js","../../src/popup.js"],"sourcesContent":["/**\n * Shared configuration for CRT overlay extension.\n * Single source of truth for storage keys, defaults, and message types.\n *\n * When adding a new option:\n * 1. Add key to STORAGE_KEYS and value to DEFAULT_OPTIONS.\n * 2. Add to STORAGE_KEYS_LIST.\n * 3. If it's a slider: add to OPTION_SLIDER_KEYS and to STORAGE_KEY_TO_OPTION / OPTION_TO_STORAGE_KEY.\n * 4. In popup.js: add to POPUP_IDS, and to SLIDER_RANGE / FILL_IDS if it's a slider.\n */\n\nexport const STORAGE_KEYS = {\n  ENABLED: \"crtEnabled\",\n  SCANLINE: \"scanlineIntensity\",\n  VIGNETTE: \"vignetteIntensity\",\n  CURVATURE: \"curvatureIntensity\",\n  GLOW: \"glowIntensity\",\n  SOUND_FILTER: \"soundFilterEnabled\",\n  SOUND_EFFECT_LEVEL: \"soundEffectLevel\",\n  SOUND_NOISE_LEVEL: \"soundNoiseLevel\",\n  VHS_GLITCHES: \"vhsGlitchesEnabled\",\n  GLITCH_PHASE_LEVEL: \"glitchPhaseLevel\",\n  GLITCH_NOISE_LEVEL: \"glitchNoiseLevel\",\n};\n\nexport const DEFAULT_OPTIONS = {\n  [STORAGE_KEYS.ENABLED]: false,\n  [STORAGE_KEYS.SCANLINE]: 0.4,\n  [STORAGE_KEYS.VIGNETTE]: 0.5,\n  [STORAGE_KEYS.CURVATURE]: 0.15,\n  [STORAGE_KEYS.GLOW]: 0.1,\n  [STORAGE_KEYS.SOUND_FILTER]: false,\n  [STORAGE_KEYS.SOUND_EFFECT_LEVEL]: 0.8,\n  [STORAGE_KEYS.SOUND_NOISE_LEVEL]: 0.6,\n  [STORAGE_KEYS.VHS_GLITCHES]: false,\n  [STORAGE_KEYS.GLITCH_PHASE_LEVEL]: 0.3,\n  [STORAGE_KEYS.GLITCH_NOISE_LEVEL]: 0.15,\n};\n\n/** All storage keys as array for batch get/set */\nexport const STORAGE_KEYS_LIST = [\n  STORAGE_KEYS.ENABLED,\n  STORAGE_KEYS.SCANLINE,\n  STORAGE_KEYS.VIGNETTE,\n  STORAGE_KEYS.CURVATURE,\n  STORAGE_KEYS.GLOW,\n  STORAGE_KEYS.SOUND_FILTER,\n  STORAGE_KEYS.SOUND_EFFECT_LEVEL,\n  STORAGE_KEYS.SOUND_NOISE_LEVEL,\n  STORAGE_KEYS.VHS_GLITCHES,\n  STORAGE_KEYS.GLITCH_PHASE_LEVEL,\n  STORAGE_KEYS.GLITCH_NOISE_LEVEL,\n];\n\n/** Option keys that are sliders (excludes ENABLED and SOUND_FILTER) */\nexport const OPTION_SLIDER_KEYS = [\n  STORAGE_KEYS.SCANLINE,\n  STORAGE_KEYS.VIGNETTE,\n  STORAGE_KEYS.CURVATURE,\n  STORAGE_KEYS.GLOW,\n];\n\nexport const MESSAGE = {\n  TOGGLE: \"toggle\",\n  SET_OPTIONS: \"setOptions\",\n  GET_STATE: \"getState\",\n};\n\n/**\n * Standard message response shape: { ok: boolean, data?: unknown }.\n * Async handlers must return a Promise that resolves to this; the listener must return true\n * when the handler is async so sendResponse remains valid.\n */\nexport function messageResponse(ok, data = undefined) {\n  return data === undefined ? { ok } : { ok, data };\n}\n\n/** Map storage key to option name (camelCase) */\nexport const STORAGE_KEY_TO_OPTION = {\n  [STORAGE_KEYS.SCANLINE]: \"scanline\",\n  [STORAGE_KEYS.VIGNETTE]: \"vignette\",\n  [STORAGE_KEYS.CURVATURE]: \"curvature\",\n  [STORAGE_KEYS.GLOW]: \"glow\",\n};\n\n/** Option name to storage key (reverse map) */\nexport const OPTION_TO_STORAGE_KEY = {\n  scanline: STORAGE_KEYS.SCANLINE,\n  vignette: STORAGE_KEYS.VIGNETTE,\n  curvature: STORAGE_KEYS.CURVATURE,\n  glow: STORAGE_KEYS.GLOW,\n};\n\n/** URL prefixes for tabs we must not send messages to */\nexport const RESTRICTED_URL_PREFIXES = [\"chrome://\", \"chrome-extension://\", \"edge://\"];\n\n/** True if we can sendMessage to this tab */\nexport function isMessageableTab(tab) {\n  return tab.id && tab.url && !RESTRICTED_URL_PREFIXES.some((p) => tab.url.startsWith(p));\n}\n","/**\n * Thin facade over chrome.storage.local and chrome.tabs for content/popup/background.\n * Enables tests to mock storage and messaging by replacing this module.\n */\n\nimport { isMessageableTab } from \"./config.js\";\n\nexport const storage = {\n  get(keys, callback) {\n    chrome.storage.local.get(keys, callback);\n  },\n  set(items, callback) {\n    chrome.storage.local.set(items, callback ?? (() => {}));\n  },\n};\n\nexport const tabs = {\n  /**\n   * Send a message to all tabs that accept content scripts (excludes chrome:// etc).\n   * @param {object} message\n   * @param {(err?: Error) => void} [onSent] called per tab (errors are passed)\n   */\n  sendToMessageableTabs(message, onSent) {\n    chrome.tabs.query({}, (tabList) => {\n      const messageable = tabList.filter(isMessageableTab);\n      messageable.forEach((tab) => {\n        chrome.tabs\n          .sendMessage(tab.id, message)\n          .then(() => onSent?.())\n          .catch((err) => onSent?.(err));\n      });\n    });\n  },\n};\n","/**\n * Dev-only logging. Logs only when extension is unpacked (no update_url) to avoid leaking info in production.\n */\nfunction isDebug() {\n  try {\n    const manifest = chrome?.runtime?.getManifest?.();\n    return !manifest?.update_url;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Log a warning when debug mode is on (unpacked extension). No-op in production.\n * @param {string} message\n * @param {unknown} [err]\n */\nexport function logExtensionWarning(message, err) {\n  if (!isDebug()) return;\n  if (err != null) {\n    console.warn(`[CRT Overlay] ${message}`, err);\n  } else {\n    console.warn(`[CRT Overlay] ${message}`);\n  }\n}\n","/**\n * Popup UI controller: syncs form state with storage and broadcasts to all tabs.\n * Popup uses VHS OSD styling (no Bulma).\n */\nimport {\n  STORAGE_KEYS,\n  DEFAULT_OPTIONS,\n  STORAGE_KEYS_LIST,\n  STORAGE_KEY_TO_OPTION,\n  OPTION_TO_STORAGE_KEY,\n  OPTION_SLIDER_KEYS,\n  MESSAGE,\n} from \"./shared/config.js\";\nimport { storage, tabs } from \"./shared/chrome-facade.js\";\nimport { logExtensionWarning } from \"./shared/logger.js\";\n\nconst POPUP_IDS = {\n  ENABLED: \"crt-enabled\",\n  SOUND_FILTER: \"crt-sound-filter\",\n  SOUND_EFFECT_LEVEL: \"sound-effect-level\",\n  SOUND_NOISE_LEVEL: \"sound-noise-level\",\n  VHS_GLITCHES: \"crt-vhs-glitches\",\n  GLITCH_PHASE_LEVEL: \"glitch-phase-level\",\n  GLITCH_NOISE_LEVEL: \"glitch-noise-level\",\n  SCANLINE: \"scanline\",\n  VIGNETTE: \"vignette\",\n  CURVATURE: \"curvature\",\n  GLOW: \"glow\",\n};\n\n/** Slider id -> { min, max } for fill width % (default 0-1) */\nconst SLIDER_RANGE = {\n  [POPUP_IDS.SOUND_EFFECT_LEVEL]: { min: 0, max: 1 },\n  [POPUP_IDS.SOUND_NOISE_LEVEL]: { min: 0, max: 1 },\n  [POPUP_IDS.GLITCH_PHASE_LEVEL]: { min: 0, max: 1 },\n  [POPUP_IDS.GLITCH_NOISE_LEVEL]: { min: 0, max: 1 },\n  [POPUP_IDS.SCANLINE]: { min: 0, max: 1 },\n  [POPUP_IDS.VIGNETTE]: { min: 0, max: 1 },\n  [POPUP_IDS.CURVATURE]: { min: 0, max: 0.5 },\n  [POPUP_IDS.GLOW]: { min: 0, max: 0.4 },\n};\n\nconst FILL_IDS = {\n  [POPUP_IDS.SOUND_EFFECT_LEVEL]: \"sound-effect-fill\",\n  [POPUP_IDS.SOUND_NOISE_LEVEL]: \"sound-noise-fill\",\n  [POPUP_IDS.GLITCH_PHASE_LEVEL]: \"glitch-phase-fill\",\n  [POPUP_IDS.GLITCH_NOISE_LEVEL]: \"glitch-noise-fill\",\n  [POPUP_IDS.SCANLINE]: \"scanline-fill\",\n  [POPUP_IDS.VIGNETTE]: \"vignette-fill\",\n  [POPUP_IDS.CURVATURE]: \"curvature-fill\",\n  [POPUP_IDS.GLOW]: \"glow-fill\",\n};\n\nclass PopupController {\n  constructor() {\n    this._enabledEl = null;\n    this._sliderIdsByOption = {\n      scanline: POPUP_IDS.SCANLINE,\n      vignette: POPUP_IDS.VIGNETTE,\n      curvature: POPUP_IDS.CURVATURE,\n      glow: POPUP_IDS.GLOW,\n    };\n  }\n\n  _getElement(id) {\n    return document.getElementById(id);\n  }\n\n  /** Read current option values from the form (sliders + sound filter) */\n  getOptionsFromForm() {\n    const options = {};\n    for (const [optionName, id] of Object.entries(this._sliderIdsByOption)) {\n      const el = this._getElement(id);\n      const storageKey = OPTION_TO_STORAGE_KEY[optionName];\n      const defaultVal = DEFAULT_OPTIONS[storageKey];\n      const value = el ? parseFloat(el.value) : defaultVal;\n      options[optionName] = Number.isNaN(value) ? defaultVal : value;\n    }\n    options.soundFilter = this._getElement(POPUP_IDS.SOUND_FILTER)?.checked ?? DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_FILTER];\n    const effectEl = this._getElement(POPUP_IDS.SOUND_EFFECT_LEVEL);\n    const noiseEl = this._getElement(POPUP_IDS.SOUND_NOISE_LEVEL);\n    options.soundEffectLevel = effectEl ? parseFloat(effectEl.value) : DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_EFFECT_LEVEL];\n    options.soundNoiseLevel = noiseEl ? parseFloat(noiseEl.value) : DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_NOISE_LEVEL];\n    if (Number.isNaN(options.soundEffectLevel)) options.soundEffectLevel = DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_EFFECT_LEVEL];\n    if (Number.isNaN(options.soundNoiseLevel)) options.soundNoiseLevel = DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_NOISE_LEVEL];\n    options.vhsGlitches = this._getElement(POPUP_IDS.VHS_GLITCHES)?.checked ?? DEFAULT_OPTIONS[STORAGE_KEYS.VHS_GLITCHES];\n    const phaseEl = this._getElement(POPUP_IDS.GLITCH_PHASE_LEVEL);\n    const videoNoiseEl = this._getElement(POPUP_IDS.GLITCH_NOISE_LEVEL);\n    options.glitchPhaseLevel = phaseEl ? parseFloat(phaseEl.value) : DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_PHASE_LEVEL];\n    options.glitchNoiseLevel = videoNoiseEl ? parseFloat(videoNoiseEl.value) : DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_NOISE_LEVEL];\n    if (Number.isNaN(options.glitchPhaseLevel)) options.glitchPhaseLevel = DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_PHASE_LEVEL];\n    if (Number.isNaN(options.glitchNoiseLevel)) options.glitchNoiseLevel = DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_NOISE_LEVEL];\n    return options;\n  }\n\n  /** Build storage payload from enabled + options */\n  _buildStoragePayload(enabled, options) {\n    return {\n      [STORAGE_KEYS.ENABLED]: enabled,\n      [STORAGE_KEYS.SOUND_FILTER]: options.soundFilter ?? DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_FILTER],\n      [STORAGE_KEYS.SOUND_EFFECT_LEVEL]: options.soundEffectLevel ?? DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_EFFECT_LEVEL],\n      [STORAGE_KEYS.SOUND_NOISE_LEVEL]: options.soundNoiseLevel ?? DEFAULT_OPTIONS[STORAGE_KEYS.SOUND_NOISE_LEVEL],\n      [STORAGE_KEYS.VHS_GLITCHES]: options.vhsGlitches ?? DEFAULT_OPTIONS[STORAGE_KEYS.VHS_GLITCHES],\n      [STORAGE_KEYS.GLITCH_PHASE_LEVEL]: options.glitchPhaseLevel ?? DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_PHASE_LEVEL],\n      [STORAGE_KEYS.GLITCH_NOISE_LEVEL]: options.glitchNoiseLevel ?? DEFAULT_OPTIONS[STORAGE_KEYS.GLITCH_NOISE_LEVEL],\n      [STORAGE_KEYS.SCANLINE]: options.scanline,\n      [STORAGE_KEYS.VIGNETTE]: options.vignette,\n      [STORAGE_KEYS.CURVATURE]: options.curvature,\n      [STORAGE_KEYS.GLOW]: options.glow,\n    };\n  }\n\n  /** Save to storage and broadcast to all messageable tabs */\n  saveAndBroadcast(enabled, options) {\n    const payload = this._buildStoragePayload(enabled, options);\n    storage.set(payload, () => {\n      if (chrome.runtime.lastError) return;\n      const msgOptions = {\n        ...options,\n        soundFilter: payload[STORAGE_KEYS.SOUND_FILTER],\n        soundEffectLevel: payload[STORAGE_KEYS.SOUND_EFFECT_LEVEL],\n        soundNoiseLevel: payload[STORAGE_KEYS.SOUND_NOISE_LEVEL],\n        vhsGlitches: payload[STORAGE_KEYS.VHS_GLITCHES],\n        glitchPhaseLevel: payload[STORAGE_KEYS.GLITCH_PHASE_LEVEL],\n        glitchNoiseLevel: payload[STORAGE_KEYS.GLITCH_NOISE_LEVEL],\n      };\n      tabs.sendToMessageableTabs(\n        { type: MESSAGE.SET_OPTIONS, options: msgOptions, visible: enabled },\n        (err) => err && logExtensionWarning(\"Popup: sendMessage to tab failed\", err)\n      );\n    });\n  }\n\n  /** Cache form element references */\n  _cacheElements() {\n    this._enabledEl = this._getElement(POPUP_IDS.ENABLED);\n  }\n\n  _updateStateLabels() {\n    const overlayLabel = this._getElement(\"overlay-label\");\n    const soundLabel = this._getElement(\"sound-label\");\n    const glitchesLabel = this._getElement(\"glitches-label\");\n    if (overlayLabel) overlayLabel.textContent = this._enabledEl?.checked ? \"OVERLAY: ON\" : \"OVERLAY: OFF\";\n    if (soundLabel) soundLabel.textContent = this._getElement(POPUP_IDS.SOUND_FILTER)?.checked ? \"VHS SOUND: ON\" : \"VHS SOUND: OFF\";\n    if (glitchesLabel) glitchesLabel.textContent = this._getElement(POPUP_IDS.VHS_GLITCHES)?.checked ? \"VHS GLITCHES: ON\" : \"VHS GLITCHES: OFF\";\n  }\n\n  /** Load storage into form */\n  loadFromStorage() {\n    storage.get(STORAGE_KEYS_LIST, (data) => {\n      if (this._enabledEl) this._enabledEl.checked = !!data[STORAGE_KEYS.ENABLED];\n      const soundEl = this._getElement(POPUP_IDS.SOUND_FILTER);\n      if (soundEl) soundEl.checked = !!data[STORAGE_KEYS.SOUND_FILTER];\n      const effectEl = this._getElement(POPUP_IDS.SOUND_EFFECT_LEVEL);\n      if (effectEl && data[STORAGE_KEYS.SOUND_EFFECT_LEVEL] != null) effectEl.value = data[STORAGE_KEYS.SOUND_EFFECT_LEVEL];\n      const noiseEl = this._getElement(POPUP_IDS.SOUND_NOISE_LEVEL);\n      if (noiseEl && data[STORAGE_KEYS.SOUND_NOISE_LEVEL] != null) noiseEl.value = data[STORAGE_KEYS.SOUND_NOISE_LEVEL];\n      const glitchesEl = this._getElement(POPUP_IDS.VHS_GLITCHES);\n      if (glitchesEl) glitchesEl.checked = !!data[STORAGE_KEYS.VHS_GLITCHES];\n      const phaseEl = this._getElement(POPUP_IDS.GLITCH_PHASE_LEVEL);\n      if (phaseEl && data[STORAGE_KEYS.GLITCH_PHASE_LEVEL] != null) phaseEl.value = data[STORAGE_KEYS.GLITCH_PHASE_LEVEL];\n      const glitchNoiseEl = this._getElement(POPUP_IDS.GLITCH_NOISE_LEVEL);\n      if (glitchNoiseEl && data[STORAGE_KEYS.GLITCH_NOISE_LEVEL] != null) glitchNoiseEl.value = data[STORAGE_KEYS.GLITCH_NOISE_LEVEL];\n\n      OPTION_SLIDER_KEYS.forEach((storageKey) => {\n        const optionName = STORAGE_KEY_TO_OPTION[storageKey];\n        const id = this._sliderIdsByOption[optionName];\n        const el = id ? this._getElement(id) : null;\n        if (el && data[storageKey] != null) el.value = data[storageKey];\n      });\n      this._updateTrackFills();\n      this._updateStateLabels();\n    });\n  }\n\n  bindEvents() {\n    this._enabledEl?.addEventListener(\"change\", () => {\n      this._updateStateLabels();\n      this.saveAndBroadcast(this._enabledEl.checked, this.getOptionsFromForm());\n    });\n    this._getElement(POPUP_IDS.SOUND_FILTER)?.addEventListener(\"change\", () => {\n      this._updateStateLabels();\n      this.saveAndBroadcast(this._enabledEl?.checked ?? false, this.getOptionsFromForm());\n    });\n    [POPUP_IDS.SOUND_EFFECT_LEVEL, POPUP_IDS.SOUND_NOISE_LEVEL].forEach((id) => {\n      this._getElement(id)?.addEventListener(\"input\", () => {\n        this._updateTrackFills();\n        this.saveAndBroadcast(this._enabledEl?.checked ?? false, this.getOptionsFromForm());\n      });\n    });\n    this._getElement(POPUP_IDS.VHS_GLITCHES)?.addEventListener(\"change\", () => {\n      this._updateStateLabels();\n      this.saveAndBroadcast(this._enabledEl?.checked ?? false, this.getOptionsFromForm());\n    });\n    [POPUP_IDS.GLITCH_PHASE_LEVEL, POPUP_IDS.GLITCH_NOISE_LEVEL].forEach((id) => {\n      this._getElement(id)?.addEventListener(\"input\", () => {\n        this._updateTrackFills();\n        this.saveAndBroadcast(this._enabledEl?.checked ?? false, this.getOptionsFromForm());\n      });\n    });\n\n    Object.values(this._sliderIdsByOption).forEach((id) => {\n      const el = this._getElement(id);\n      el?.addEventListener(\"input\", () => {\n        this._updateTrackFills();\n        const enabled = this._getElement(POPUP_IDS.ENABLED)?.checked ?? false;\n        this.saveAndBroadcast(enabled, this.getOptionsFromForm());\n      });\n    });\n  }\n\n  _updateTrackFills() {\n    Object.entries(FILL_IDS).forEach(([sliderId, fillId]) => {\n      const range = SLIDER_RANGE[sliderId] || { min: 0, max: 1 };\n      const el = this._getElement(sliderId);\n      const fill = this._getElement(fillId);\n      if (!el || !fill) return;\n      const val = parseFloat(el.value) || range.min;\n      const pct = ((val - range.min) / (range.max - range.min)) * 100;\n      fill.style.width = `${Math.max(0, Math.min(100, pct))}%`;\n    });\n  }\n\n  init() {\n    this._cacheElements();\n    this.loadFromStorage();\n    this.bindEvents();\n    this._updateTrackFills();\n    this._updateStateLabels();\n  }\n}\n\nconst controller = new PopupController();\ncontroller.init();\n"],"names":["_a"],"mappings":"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"}