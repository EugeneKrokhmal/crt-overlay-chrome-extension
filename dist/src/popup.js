(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const _ of t)if(_.type==="childList")for(const c of _.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function l(t){const _={};return t.integrity&&(_.integrity=t.integrity),t.referrerPolicy&&(_.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?_.credentials="include":t.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function s(t){if(t.ep)return;t.ep=!0;const _=l(t);fetch(t.href,_)}})();const e={ENABLED:"crtEnabled",SCANLINE:"scanlineIntensity",VIGNETTE:"vignetteIntensity",GLOW:"glowIntensity",SOUND_FILTER:"soundFilterEnabled",SOUND_EFFECT_LEVEL:"soundEffectLevel",SOUND_NOISE_LEVEL:"soundNoiseLevel",VHS_GLITCHES:"vhsGlitchesEnabled",GLITCH_PHASE_LEVEL:"glitchPhaseLevel",GLITCH_NOISE_LEVEL:"glitchNoiseLevel",GLITCH_TRACKING_LEVEL:"glitchTrackingLevel",GLITCH_WOBBLE_LEVEL:"glitchWobbleLevel",GLITCH_HEADSWITCH_LEVEL:"glitchHeadswitchLevel",GLITCH_RGB_LEVEL:"glitchRgbLevel",GLITCH_DROPOUT_LEVEL:"glitchDropoutLevel"},i={[e.ENABLED]:!1,[e.SCANLINE]:.4,[e.VIGNETTE]:.5,[e.GLOW]:.15,[e.SOUND_FILTER]:!1,[e.SOUND_EFFECT_LEVEL]:.8,[e.SOUND_NOISE_LEVEL]:.6,[e.VHS_GLITCHES]:!1,[e.GLITCH_PHASE_LEVEL]:.3,[e.GLITCH_NOISE_LEVEL]:.15,[e.GLITCH_TRACKING_LEVEL]:.5,[e.GLITCH_WOBBLE_LEVEL]:.3,[e.GLITCH_HEADSWITCH_LEVEL]:.25,[e.GLITCH_RGB_LEVEL]:.35,[e.GLITCH_DROPOUT_LEVEL]:.2},g=[e.ENABLED,e.SCANLINE,e.VIGNETTE,e.GLOW,e.SOUND_FILTER,e.SOUND_EFFECT_LEVEL,e.SOUND_NOISE_LEVEL,e.VHS_GLITCHES,e.GLITCH_PHASE_LEVEL,e.GLITCH_NOISE_LEVEL,e.GLITCH_TRACKING_LEVEL,e.GLITCH_WOBBLE_LEVEL,e.GLITCH_HEADSWITCH_LEVEL,e.GLITCH_RGB_LEVEL,e.GLITCH_DROPOUT_LEVEL],u=[e.SCANLINE,e.VIGNETTE,e.GLOW],d={SET_OPTIONS:"setOptions"},m={[e.SCANLINE]:"scanline",[e.VIGNETTE]:"vignette",[e.GLOW]:"glow"},v={scanline:e.SCANLINE,vignette:e.VIGNETTE,glow:e.GLOW},f=["chrome://","chrome-extension://","edge://"];function D(n){return n.id&&n.url&&!f.some(E=>n.url.startsWith(E))}const V={get(n,E){chrome.storage.local.get(n,E)},set(n,E){chrome.storage.local.set(n,E??(()=>{}))}},b={sendToMessageableTabs(n,E){chrome.tabs.query({},l=>{l.filter(D).forEach(t=>{chrome.tabs.sendMessage(t.id,n).then(()=>E==null?void 0:E()).catch(_=>E==null?void 0:E(_))})})}};function F(){var n,E;try{const l=(E=(n=chrome==null?void 0:chrome.runtime)==null?void 0:n.getManifest)==null?void 0:E.call(n);return!(l!=null&&l.update_url)}catch{return!1}}function A(n,E){F()&&(E!=null?console.warn(`[CRT Overlay] ${n}`,E):console.warn(`[CRT Overlay] ${n}`))}const L={ENABLED:"crt-enabled",SOUND_FILTER:"crt-sound-filter",SOUND_EFFECT_LEVEL:"sound-effect-level",SOUND_NOISE_LEVEL:"sound-noise-level",VHS_GLITCHES:"crt-vhs-glitches",GLITCH_PHASE_LEVEL:"glitch-phase-level",GLITCH_NOISE_LEVEL:"glitch-noise-level",GLITCH_TRACKING_LEVEL:"glitch-tracking-level",GLITCH_WOBBLE_LEVEL:"glitch-wobble-level",GLITCH_HEADSWITCH_LEVEL:"glitch-headswitch-level",GLITCH_RGB_LEVEL:"glitch-rgb-level",GLITCH_DROPOUT_LEVEL:"glitch-dropout-level",SCANLINE:"scanline",VIGNETTE:"vignette",GLOW:"glow"},R={[L.SOUND_EFFECT_LEVEL]:{min:0,max:1},[L.SOUND_NOISE_LEVEL]:{min:0,max:1},[L.GLITCH_PHASE_LEVEL]:{min:0,max:1},[L.GLITCH_NOISE_LEVEL]:{min:0,max:1},[L.GLITCH_TRACKING_LEVEL]:{min:0,max:1},[L.GLITCH_WOBBLE_LEVEL]:{min:0,max:1},[L.GLITCH_HEADSWITCH_LEVEL]:{min:0,max:1},[L.GLITCH_RGB_LEVEL]:{min:0,max:1},[L.GLITCH_DROPOUT_LEVEL]:{min:0,max:1},[L.SCANLINE]:{min:0,max:1},[L.VIGNETTE]:{min:0,max:1},[L.GLOW]:{min:0,max:.8}},B={[L.SOUND_EFFECT_LEVEL]:"sound-effect-fill",[L.SOUND_NOISE_LEVEL]:"sound-noise-fill",[L.GLITCH_PHASE_LEVEL]:"glitch-phase-fill",[L.GLITCH_NOISE_LEVEL]:"glitch-noise-fill",[L.GLITCH_TRACKING_LEVEL]:"glitch-tracking-fill",[L.GLITCH_WOBBLE_LEVEL]:"glitch-wobble-fill",[L.GLITCH_HEADSWITCH_LEVEL]:"glitch-headswitch-fill",[L.GLITCH_RGB_LEVEL]:"glitch-rgb-fill",[L.GLITCH_DROPOUT_LEVEL]:"glitch-dropout-fill",[L.SCANLINE]:"scanline-fill",[L.VIGNETTE]:"vignette-fill",[L.GLOW]:"glow-fill"},U=80;class p{constructor(){this._enabledEl=null,this._saveDebounceTimer=null,this._sliderIdsByOption={scanline:L.SCANLINE,vignette:L.VIGNETTE,glow:L.GLOW}}_debouncedSaveAndBroadcast(){this._saveDebounceTimer!=null&&clearTimeout(this._saveDebounceTimer),this._saveDebounceTimer=setTimeout(()=>{var l;this._saveDebounceTimer=null;const E=((l=this._enabledEl)==null?void 0:l.checked)??!1;this.saveAndBroadcast(E,this.getOptionsFromForm())},U)}_getElement(E){return document.getElementById(E)}getOptionsFromForm(){var r,H;const E={};for(const[T,G]of Object.entries(this._sliderIdsByOption)){const N=this._getElement(G),C=v[T],O=i[C],S=N?parseFloat(N.value):O;E[T]=Number.isNaN(S)?O:S}E.soundFilter=((r=this._getElement(L.SOUND_FILTER))==null?void 0:r.checked)??i[e.SOUND_FILTER];const l=this._getElement(L.SOUND_EFFECT_LEVEL),s=this._getElement(L.SOUND_NOISE_LEVEL);E.soundEffectLevel=l?parseFloat(l.value):i[e.SOUND_EFFECT_LEVEL],E.soundNoiseLevel=s?parseFloat(s.value):i[e.SOUND_NOISE_LEVEL],Number.isNaN(E.soundEffectLevel)&&(E.soundEffectLevel=i[e.SOUND_EFFECT_LEVEL]),Number.isNaN(E.soundNoiseLevel)&&(E.soundNoiseLevel=i[e.SOUND_NOISE_LEVEL]),E.vhsGlitches=((H=this._getElement(L.VHS_GLITCHES))==null?void 0:H.checked)??i[e.VHS_GLITCHES];const t=this._getElement(L.GLITCH_PHASE_LEVEL),_=this._getElement(L.GLITCH_NOISE_LEVEL);E.glitchPhaseLevel=t?parseFloat(t.value):i[e.GLITCH_PHASE_LEVEL],E.glitchNoiseLevel=_?parseFloat(_.value):i[e.GLITCH_NOISE_LEVEL];const c=this._getElement(L.GLITCH_TRACKING_LEVEL),o=this._getElement(L.GLITCH_WOBBLE_LEVEL),I=this._getElement(L.GLITCH_HEADSWITCH_LEVEL);E.glitchTrackingLevel=c?parseFloat(c.value):i[e.GLITCH_TRACKING_LEVEL],E.glitchWobbleLevel=o?parseFloat(o.value):i[e.GLITCH_WOBBLE_LEVEL],E.glitchHeadswitchLevel=I?parseFloat(I.value):i[e.GLITCH_HEADSWITCH_LEVEL];const a=this._getElement(L.GLITCH_RGB_LEVEL),h=this._getElement(L.GLITCH_DROPOUT_LEVEL);return E.glitchRgbLevel=a?parseFloat(a.value):i[e.GLITCH_RGB_LEVEL],E.glitchDropoutLevel=h?parseFloat(h.value):i[e.GLITCH_DROPOUT_LEVEL],Number.isNaN(E.glitchPhaseLevel)&&(E.glitchPhaseLevel=i[e.GLITCH_PHASE_LEVEL]),Number.isNaN(E.glitchNoiseLevel)&&(E.glitchNoiseLevel=i[e.GLITCH_NOISE_LEVEL]),Number.isNaN(E.glitchTrackingLevel)&&(E.glitchTrackingLevel=i[e.GLITCH_TRACKING_LEVEL]),Number.isNaN(E.glitchWobbleLevel)&&(E.glitchWobbleLevel=i[e.GLITCH_WOBBLE_LEVEL]),Number.isNaN(E.glitchHeadswitchLevel)&&(E.glitchHeadswitchLevel=i[e.GLITCH_HEADSWITCH_LEVEL]),Number.isNaN(E.glitchRgbLevel)&&(E.glitchRgbLevel=i[e.GLITCH_RGB_LEVEL]),Number.isNaN(E.glitchDropoutLevel)&&(E.glitchDropoutLevel=i[e.GLITCH_DROPOUT_LEVEL]),E}_buildStoragePayload(E,l){return{[e.ENABLED]:E,[e.SOUND_FILTER]:l.soundFilter??i[e.SOUND_FILTER],[e.SOUND_EFFECT_LEVEL]:l.soundEffectLevel??i[e.SOUND_EFFECT_LEVEL],[e.SOUND_NOISE_LEVEL]:l.soundNoiseLevel??i[e.SOUND_NOISE_LEVEL],[e.VHS_GLITCHES]:l.vhsGlitches??i[e.VHS_GLITCHES],[e.GLITCH_PHASE_LEVEL]:l.glitchPhaseLevel??i[e.GLITCH_PHASE_LEVEL],[e.GLITCH_NOISE_LEVEL]:l.glitchNoiseLevel??i[e.GLITCH_NOISE_LEVEL],[e.GLITCH_TRACKING_LEVEL]:l.glitchTrackingLevel??i[e.GLITCH_TRACKING_LEVEL],[e.GLITCH_WOBBLE_LEVEL]:l.glitchWobbleLevel??i[e.GLITCH_WOBBLE_LEVEL],[e.GLITCH_HEADSWITCH_LEVEL]:l.glitchHeadswitchLevel??i[e.GLITCH_HEADSWITCH_LEVEL],[e.GLITCH_RGB_LEVEL]:l.glitchRgbLevel??i[e.GLITCH_RGB_LEVEL],[e.GLITCH_DROPOUT_LEVEL]:l.glitchDropoutLevel??i[e.GLITCH_DROPOUT_LEVEL],[e.SCANLINE]:l.scanline,[e.VIGNETTE]:l.vignette,[e.GLOW]:l.glow}}saveAndBroadcast(E,l){const s=this._buildStoragePayload(E,l);V.set(s,()=>{if(chrome.runtime.lastError)return;const t={...l,soundFilter:s[e.SOUND_FILTER],soundEffectLevel:s[e.SOUND_EFFECT_LEVEL],soundNoiseLevel:s[e.SOUND_NOISE_LEVEL],vhsGlitches:s[e.VHS_GLITCHES],glitchPhaseLevel:s[e.GLITCH_PHASE_LEVEL],glitchNoiseLevel:s[e.GLITCH_NOISE_LEVEL],glitchTrackingLevel:s[e.GLITCH_TRACKING_LEVEL],glitchWobbleLevel:s[e.GLITCH_WOBBLE_LEVEL],glitchHeadswitchLevel:s[e.GLITCH_HEADSWITCH_LEVEL],glitchRgbLevel:s[e.GLITCH_RGB_LEVEL],glitchDropoutLevel:s[e.GLITCH_DROPOUT_LEVEL]};b.sendToMessageableTabs({type:d.SET_OPTIONS,options:t,visible:E},_=>{_&&(_.message&&_.message.includes("Receiving end does not exist")||A("Popup: sendMessage to tab failed",_))})})}_cacheElements(){this._enabledEl=this._getElement(L.ENABLED)}_updateStateLabels(){var t,_,c;const E=this._getElement("overlay-label"),l=this._getElement("sound-label"),s=this._getElement("glitches-label");E&&(E.textContent=(t=this._enabledEl)!=null&&t.checked?"OVERLAY: ON":"OVERLAY: OFF"),l&&(l.textContent=(_=this._getElement(L.SOUND_FILTER))!=null&&_.checked?"VHS SOUND: ON":"VHS SOUND: OFF"),s&&(s.textContent=(c=this._getElement(L.VHS_GLITCHES))!=null&&c.checked?"VHS GLITCHES: ON":"VHS GLITCHES: OFF")}loadFromStorage(){V.get(g,E=>{this._enabledEl&&(this._enabledEl.checked=!!E[e.ENABLED]);const l=this._getElement(L.SOUND_FILTER);l&&(l.checked=!!E[e.SOUND_FILTER]);const s=this._getElement(L.SOUND_EFFECT_LEVEL);s&&E[e.SOUND_EFFECT_LEVEL]!=null&&(s.value=E[e.SOUND_EFFECT_LEVEL]);const t=this._getElement(L.SOUND_NOISE_LEVEL);t&&E[e.SOUND_NOISE_LEVEL]!=null&&(t.value=E[e.SOUND_NOISE_LEVEL]);const _=this._getElement(L.VHS_GLITCHES);_&&(_.checked=!!E[e.VHS_GLITCHES]);const c=this._getElement(L.GLITCH_PHASE_LEVEL);c&&E[e.GLITCH_PHASE_LEVEL]!=null&&(c.value=E[e.GLITCH_PHASE_LEVEL]);const o=this._getElement(L.GLITCH_NOISE_LEVEL);o&&E[e.GLITCH_NOISE_LEVEL]!=null&&(o.value=E[e.GLITCH_NOISE_LEVEL]);const I=this._getElement(L.GLITCH_TRACKING_LEVEL);I&&E[e.GLITCH_TRACKING_LEVEL]!=null&&(I.value=E[e.GLITCH_TRACKING_LEVEL]);const a=this._getElement(L.GLITCH_WOBBLE_LEVEL);a&&E[e.GLITCH_WOBBLE_LEVEL]!=null&&(a.value=E[e.GLITCH_WOBBLE_LEVEL]);const h=this._getElement(L.GLITCH_HEADSWITCH_LEVEL);h&&E[e.GLITCH_HEADSWITCH_LEVEL]!=null&&(h.value=E[e.GLITCH_HEADSWITCH_LEVEL]);const r=this._getElement(L.GLITCH_RGB_LEVEL);r&&E[e.GLITCH_RGB_LEVEL]!=null&&(r.value=E[e.GLITCH_RGB_LEVEL]);const H=this._getElement(L.GLITCH_DROPOUT_LEVEL);H&&E[e.GLITCH_DROPOUT_LEVEL]!=null&&(H.value=E[e.GLITCH_DROPOUT_LEVEL]),u.forEach(T=>{const G=m[T],N=this._sliderIdsByOption[G],C=N?this._getElement(N):null;C&&E[T]!=null&&(C.value=E[T])}),this._updateTrackFills(),this._updateStateLabels()})}bindEvents(){var E,l,s;(E=this._enabledEl)==null||E.addEventListener("change",()=>{this._updateStateLabels(),this.saveAndBroadcast(this._enabledEl.checked,this.getOptionsFromForm())}),(l=this._getElement(L.SOUND_FILTER))==null||l.addEventListener("change",()=>{var t;this._updateStateLabels(),this.saveAndBroadcast(((t=this._enabledEl)==null?void 0:t.checked)??!1,this.getOptionsFromForm())}),[L.SOUND_EFFECT_LEVEL,L.SOUND_NOISE_LEVEL].forEach(t=>{var _;(_=this._getElement(t))==null||_.addEventListener("input",()=>{this._updateTrackFills(),this._debouncedSaveAndBroadcast()})}),(s=this._getElement(L.VHS_GLITCHES))==null||s.addEventListener("change",()=>{var t;this._updateStateLabels(),this.saveAndBroadcast(((t=this._enabledEl)==null?void 0:t.checked)??!1,this.getOptionsFromForm())}),[L.GLITCH_PHASE_LEVEL,L.GLITCH_NOISE_LEVEL,L.GLITCH_TRACKING_LEVEL,L.GLITCH_WOBBLE_LEVEL,L.GLITCH_HEADSWITCH_LEVEL,L.GLITCH_RGB_LEVEL,L.GLITCH_DROPOUT_LEVEL].forEach(t=>{var _;(_=this._getElement(t))==null||_.addEventListener("input",()=>{this._updateTrackFills(),this._debouncedSaveAndBroadcast()})}),Object.values(this._sliderIdsByOption).forEach(t=>{const _=this._getElement(t);_==null||_.addEventListener("input",()=>{this._updateTrackFills(),this._debouncedSaveAndBroadcast()})})}_updateTrackFills(){Object.entries(B).forEach(([E,l])=>{const s=R[E]||{min:0,max:1},t=this._getElement(E),_=this._getElement(l);if(!t||!_)return;const o=((parseFloat(t.value)||s.min)-s.min)/(s.max-s.min)*100;_.style.width=`${Math.max(0,Math.min(100,o))}%`})}init(){this._cacheElements(),this.loadFromStorage(),this.bindEvents(),this._updateTrackFills(),this._updateStateLabels()}}const P=new p;P.init();
