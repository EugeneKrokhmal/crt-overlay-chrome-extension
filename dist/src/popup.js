(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function l(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=l(n);fetch(n.href,s)}})();const c=[{name:"ENABLED",key:"crtEnabled",default:!1,type:"checkbox",popupId:"crt-enabled",contentKey:null},{name:"SOUND_FILTER",key:"soundFilterEnabled",default:!1,type:"checkbox",popupId:"crt-sound-filter",contentKey:"soundFilter"},{name:"SOUND_EFFECT_LEVEL",key:"soundEffectLevel",default:.8,type:"slider",popupId:"sound-effect-level",fillId:"sound-effect-fill",min:0,max:1},{name:"SOUND_NOISE_LEVEL",key:"soundNoiseLevel",default:.6,type:"slider",popupId:"sound-noise-level",fillId:"sound-noise-fill",min:0,max:1},{name:"SOUND_OVERRIDE_LEVEL",key:"soundOverdriveLevel",default:0,type:"slider",popupId:"sound-overdrive-level",fillId:"sound-overdrive-fill",min:0,max:1},{name:"SOUND_CHORUS_LEVEL",key:"soundChorusLevel",default:0,type:"slider",popupId:"sound-chorus-level",fillId:"sound-chorus-fill",min:0,max:1},{name:"VHS_GLITCHES",key:"vhsGlitchesEnabled",default:!1,type:"checkbox",popupId:"crt-vhs-glitches",contentKey:"vhsGlitches"},{name:"GLITCH_PHASE_LEVEL",key:"glitchPhaseLevel",default:.3,type:"slider",popupId:"glitch-phase-level",fillId:"glitch-phase-fill",min:0,max:1},{name:"GLITCH_NOISE_LEVEL",key:"glitchNoiseLevel",default:.15,type:"slider",popupId:"glitch-noise-level",fillId:"glitch-noise-fill",min:0,max:1},{name:"GLITCH_TRACKING_LEVEL",key:"glitchTrackingLevel",default:.5,type:"slider",popupId:"glitch-tracking-level",fillId:"glitch-tracking-fill",min:0,max:1},{name:"GLITCH_WOBBLE_LEVEL",key:"glitchWobbleLevel",default:.3,type:"slider",popupId:"glitch-wobble-level",fillId:"glitch-wobble-fill",min:0,max:1},{name:"GLITCH_HEADSWITCH_LEVEL",key:"glitchHeadswitchLevel",default:.25,type:"slider",popupId:"glitch-headswitch-level",fillId:"glitch-headswitch-fill",min:0,max:1},{name:"GLITCH_RGB_LEVEL",key:"glitchRgbLevel",default:.35,type:"slider",popupId:"glitch-rgb-level",fillId:"glitch-rgb-fill",min:0,max:1},{name:"GLITCH_DROPOUT_LEVEL",key:"glitchDropoutLevel",default:.2,type:"slider",popupId:"glitch-dropout-level",fillId:"glitch-dropout-fill",min:0,max:1},{name:"GLITCH_REWIND_LEVEL",key:"glitchRewindLevel",default:.4,type:"slider",popupId:"glitch-rewind-level",fillId:"glitch-rewind-fill",min:0,max:1},{name:"SCANLINE",key:"scanlineIntensity",default:.4,type:"slider",popupId:"scanline",fillId:"scanline-fill",min:0,max:1,optionName:"scanline"},{name:"VIGNETTE",key:"vignetteIntensity",default:.5,type:"slider",popupId:"vignette",fillId:"vignette-fill",min:0,max:1,optionName:"vignette"},{name:"GLOW",key:"glowIntensity",default:.15,type:"slider",popupId:"glow",fillId:"glow-fill",min:0,max:.8,optionName:"glow"}],a=c,f=Object.fromEntries(a.map(e=>[e.name,e.key])),h=Object.fromEntries(a.map(e=>[e.key,e.default])),E=a.map(e=>e.key),u=a.filter(e=>e.type==="slider");a.filter(e=>e.optionName).map(e=>e.key);Object.fromEntries(a.filter(e=>e.optionName).map(e=>[e.key,e.optionName]));Object.fromEntries(a.filter(e=>e.optionName).map(e=>[e.optionName,e.key]));const r=Object.fromEntries(a.filter(e=>e.popupId).map(e=>[e.name,e.popupId])),g=Object.fromEntries(u.map(e=>[e.popupId,{min:e.min,max:e.max}])),y=Object.fromEntries(a.filter(e=>e.fillId).map(e=>[e.popupId,e.fillId]));Object.fromEntries(u.map(e=>[e.popupId,e.key]));function d(e){return e.contentKey!=null?e.contentKey:e.optionName??e.key}const _={SET_OPTIONS:"setOptions"},I=["chrome://","chrome-extension://","edge://"];function L(e){return e.id&&e.url&&!I.some(t=>e.url.startsWith(t))}const p={get(e,t){chrome.storage.local.get(e,t)},set(e,t){chrome.storage.local.set(e,t??(()=>{}))}},b={sendToMessageableTabs(e,t){chrome.tabs.query({},l=>{l.filter(L).forEach(n=>{chrome.tabs.sendMessage(n.id,e).then(()=>t==null?void 0:t()).catch(s=>t==null?void 0:t(s))})})}};function v(){var e,t;try{const l=(t=(e=chrome==null?void 0:chrome.runtime)==null?void 0:e.getManifest)==null?void 0:t.call(e);return!(l!=null&&l.update_url)}catch{return!1}}function O(e,t){v()&&(t!=null?console.warn(`[CRT Overlay] ${e}`,t):console.warn(`[CRT Overlay] ${e}`))}const T=80;class k{constructor(){this._enabledEl=null,this._saveDebounceTimer=null}_debouncedSaveAndBroadcast(){this._saveDebounceTimer!=null&&clearTimeout(this._saveDebounceTimer),this._saveDebounceTimer=setTimeout(()=>{var l;this._saveDebounceTimer=null;const t=((l=this._enabledEl)==null?void 0:l.checked)??!1;this.saveAndBroadcast(t,this.getOptionsFromForm())},T)}_getElement(t){return document.getElementById(t)}getOptionsFromForm(){const t={};for(const l of c){if(l.name==="ENABLED"||!l.popupId)continue;const i=d(l),n=this._getElement(l.popupId),s=l.type==="checkbox"?(n==null?void 0:n.checked)??l.default:n?parseFloat(n.value):l.default,o=l.type==="checkbox"?!!s:Number.isNaN(s)?l.default:s;t[i]=o}return t}_buildStoragePayload(t,l){const i={[f.ENABLED]:t};for(const n of c){if(n.name==="ENABLED")continue;const s=d(n);i[n.key]=l[s]??n.default}return i}_payloadToMsgOptions(t){const l={};for(const i of c)i.name!=="ENABLED"&&(l[d(i)]=t[i.key]);return l}saveAndBroadcast(t,l){const i=this._buildStoragePayload(t,l);p.set(i,()=>{if(chrome.runtime.lastError)return;const n=this._payloadToMsgOptions(i);b.sendToMessageableTabs({type:_.SET_OPTIONS,options:n,visible:t},s=>{s&&(s.message&&s.message.includes("Receiving end does not exist")||O("Popup: sendMessage to tab failed",s))})})}_cacheElements(){this._enabledEl=this._getElement(r.ENABLED)}_updateStateLabels(){var n,s,o;const t=this._getElement("overlay-label"),l=this._getElement("sound-label"),i=this._getElement("glitches-label");t&&(t.textContent=(n=this._enabledEl)!=null&&n.checked?"OVERLAY: ON":"OVERLAY: OFF"),l&&(l.textContent=(s=this._getElement(r.SOUND_FILTER))!=null&&s.checked?"VHS SOUND: ON":"VHS SOUND: OFF"),i&&(i.textContent=(o=this._getElement(r.VHS_GLITCHES))!=null&&o.checked?"VHS GLITCHES: ON":"VHS GLITCHES: OFF")}_applyPayloadToForm(t){if(t)for(const l of c){if(!l.popupId)continue;const i=this._getElement(l.popupId);i&&(l.type==="checkbox"?i.checked=!!t[l.key]:t[l.key]!=null&&(i.value=t[l.key]))}}loadFromStorage(){p.get(E,t=>{this._applyPayloadToForm(t),this._updateTrackFills(),this._updateStateLabels()})}resetToDefaults(){var l;this._applyPayloadToForm(h),this._updateTrackFills(),this._updateStateLabels();const t=((l=this._enabledEl)==null?void 0:l.checked)??!1;this.saveAndBroadcast(t,this.getOptionsFromForm())}randomize(){var l;for(const i of c){if(!i.popupId)continue;const n=this._getElement(i.popupId);if(n){if(i.type==="checkbox")n.checked=Math.random()<.5;else if(i.type==="slider"&&i.min!=null&&i.max!=null){const s=i.min+Math.random()*(i.max-i.min);n.value=String(Math.round(s*100)/100)}}}this._enabledEl&&(this._enabledEl.checked=Math.random()<.4),this._updateTrackFills(),this._updateStateLabels();const t=((l=this._enabledEl)==null?void 0:l.checked)??!1;this.saveAndBroadcast(t,this.getOptionsFromForm())}bindEvents(){var t,l,i;(t=this._enabledEl)==null||t.addEventListener("change",()=>{this._updateStateLabels(),this.saveAndBroadcast(this._enabledEl.checked,this.getOptionsFromForm())});for(const n of c){if(!n.popupId)continue;const s=this._getElement(n.popupId);s&&(n.type==="checkbox"?s.addEventListener("change",()=>{var o;this._updateStateLabels(),this.saveAndBroadcast(((o=this._enabledEl)==null?void 0:o.checked)??!1,this.getOptionsFromForm())}):s.addEventListener("input",()=>{this._updateTrackFills(),this._debouncedSaveAndBroadcast()}))}(l=this._getElement("crt-reset-btn"))==null||l.addEventListener("click",()=>this.resetToDefaults()),(i=this._getElement("crt-random-btn"))==null||i.addEventListener("click",()=>this.randomize())}_updateTrackFills(){for(const[t,l]of Object.entries(y)){const i=g[t]??{min:0,max:1},n=this._getElement(t),s=this._getElement(l);if(!n||!s)continue;const m=((parseFloat(n.value)||i.min)-i.min)/(i.max-i.min)*100;s.style.width=`${Math.max(0,Math.min(100,m))}%`}}init(){this._cacheElements(),this.loadFromStorage(),this.bindEvents(),this._updateTrackFills(),this._updateStateLabels()}}const S=new k;S.init();
