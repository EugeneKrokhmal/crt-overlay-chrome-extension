(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))n(E);new MutationObserver(E=>{for(const l of E)if(l.type==="childList")for(const L of l.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&n(L)}).observe(document,{childList:!0,subtree:!0});function i(E){const l={};return E.integrity&&(l.integrity=E.integrity),E.referrerPolicy&&(l.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?l.credentials="include":E.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(E){if(E.ep)return;E.ep=!0;const l=i(E);fetch(E.href,l)}})();const e={ENABLED:"crtEnabled",SCANLINE:"scanlineIntensity",VIGNETTE:"vignetteIntensity",CURVATURE:"curvatureIntensity",GLOW:"glowIntensity",SOUND_FILTER:"soundFilterEnabled",SOUND_EFFECT_LEVEL:"soundEffectLevel",SOUND_NOISE_LEVEL:"soundNoiseLevel",VHS_GLITCHES:"vhsGlitchesEnabled",GLITCH_PHASE_LEVEL:"glitchPhaseLevel",GLITCH_NOISE_LEVEL:"glitchNoiseLevel"},o={[e.ENABLED]:!1,[e.SCANLINE]:.4,[e.VIGNETTE]:.5,[e.CURVATURE]:.15,[e.GLOW]:.1,[e.SOUND_FILTER]:!1,[e.SOUND_EFFECT_LEVEL]:.8,[e.SOUND_NOISE_LEVEL]:.6,[e.VHS_GLITCHES]:!1,[e.GLITCH_PHASE_LEVEL]:.3,[e.GLITCH_NOISE_LEVEL]:.15},I=[e.ENABLED,e.SCANLINE,e.VIGNETTE,e.CURVATURE,e.GLOW,e.SOUND_FILTER,e.SOUND_EFFECT_LEVEL,e.SOUND_NOISE_LEVEL,e.VHS_GLITCHES,e.GLITCH_PHASE_LEVEL,e.GLITCH_NOISE_LEVEL],d=[e.SCANLINE,e.VIGNETTE,e.CURVATURE,e.GLOW],u={SET_OPTIONS:"setOptions"},g={[e.SCANLINE]:"scanline",[e.VIGNETTE]:"vignette",[e.CURVATURE]:"curvature",[e.GLOW]:"glow"},m={scanline:e.SCANLINE,vignette:e.VIGNETTE,curvature:e.CURVATURE,glow:e.GLOW},V=["chrome://","chrome-extension://","edge://"];function f(_){return _.id&&_.url&&!V.some(t=>_.url.startsWith(t))}const T={get(_,t){chrome.storage.local.get(_,t)},set(_,t){chrome.storage.local.set(_,t??(()=>{}))}},C={sendToMessageableTabs(_,t){chrome.tabs.query({},i=>{i.filter(f).forEach(E=>{chrome.tabs.sendMessage(E.id,_).then(()=>t==null?void 0:t()).catch(l=>t==null?void 0:t(l))})})}};function F(){var _,t;try{const i=(t=(_=chrome==null?void 0:chrome.runtime)==null?void 0:_.getManifest)==null?void 0:t.call(_);return!(i!=null&&i.update_url)}catch{return!1}}function v(_,t){F()&&(t!=null?console.warn(`[CRT Overlay] ${_}`,t):console.warn(`[CRT Overlay] ${_}`))}const s={ENABLED:"crt-enabled",SOUND_FILTER:"crt-sound-filter",SOUND_EFFECT_LEVEL:"sound-effect-level",SOUND_NOISE_LEVEL:"sound-noise-level",VHS_GLITCHES:"crt-vhs-glitches",GLITCH_PHASE_LEVEL:"glitch-phase-level",GLITCH_NOISE_LEVEL:"glitch-noise-level",SCANLINE:"scanline",VIGNETTE:"vignette",CURVATURE:"curvature",GLOW:"glow"},H={[s.SOUND_EFFECT_LEVEL]:{min:0,max:1},[s.SOUND_NOISE_LEVEL]:{min:0,max:1},[s.GLITCH_PHASE_LEVEL]:{min:0,max:1},[s.GLITCH_NOISE_LEVEL]:{min:0,max:1},[s.SCANLINE]:{min:0,max:1},[s.VIGNETTE]:{min:0,max:1},[s.CURVATURE]:{min:0,max:.5},[s.GLOW]:{min:0,max:.4}},G={[s.SOUND_EFFECT_LEVEL]:"sound-effect-fill",[s.SOUND_NOISE_LEVEL]:"sound-noise-fill",[s.GLITCH_PHASE_LEVEL]:"glitch-phase-fill",[s.GLITCH_NOISE_LEVEL]:"glitch-noise-fill",[s.SCANLINE]:"scanline-fill",[s.VIGNETTE]:"vignette-fill",[s.CURVATURE]:"curvature-fill",[s.GLOW]:"glow-fill"};class U{constructor(){this._enabledEl=null,this._sliderIdsByOption={scanline:s.SCANLINE,vignette:s.VIGNETTE,curvature:s.CURVATURE,glow:s.GLOW}}_getElement(t){return document.getElementById(t)}getOptionsFromForm(){var L,c;const t={};for(const[a,S]of Object.entries(this._sliderIdsByOption)){const r=this._getElement(S),N=m[a],h=o[N],O=r?parseFloat(r.value):h;t[a]=Number.isNaN(O)?h:O}t.soundFilter=((L=this._getElement(s.SOUND_FILTER))==null?void 0:L.checked)??o[e.SOUND_FILTER];const i=this._getElement(s.SOUND_EFFECT_LEVEL),n=this._getElement(s.SOUND_NOISE_LEVEL);t.soundEffectLevel=i?parseFloat(i.value):o[e.SOUND_EFFECT_LEVEL],t.soundNoiseLevel=n?parseFloat(n.value):o[e.SOUND_NOISE_LEVEL],Number.isNaN(t.soundEffectLevel)&&(t.soundEffectLevel=o[e.SOUND_EFFECT_LEVEL]),Number.isNaN(t.soundNoiseLevel)&&(t.soundNoiseLevel=o[e.SOUND_NOISE_LEVEL]),t.vhsGlitches=((c=this._getElement(s.VHS_GLITCHES))==null?void 0:c.checked)??o[e.VHS_GLITCHES];const E=this._getElement(s.GLITCH_PHASE_LEVEL),l=this._getElement(s.GLITCH_NOISE_LEVEL);return t.glitchPhaseLevel=E?parseFloat(E.value):o[e.GLITCH_PHASE_LEVEL],t.glitchNoiseLevel=l?parseFloat(l.value):o[e.GLITCH_NOISE_LEVEL],Number.isNaN(t.glitchPhaseLevel)&&(t.glitchPhaseLevel=o[e.GLITCH_PHASE_LEVEL]),Number.isNaN(t.glitchNoiseLevel)&&(t.glitchNoiseLevel=o[e.GLITCH_NOISE_LEVEL]),t}_buildStoragePayload(t,i){return{[e.ENABLED]:t,[e.SOUND_FILTER]:i.soundFilter??o[e.SOUND_FILTER],[e.SOUND_EFFECT_LEVEL]:i.soundEffectLevel??o[e.SOUND_EFFECT_LEVEL],[e.SOUND_NOISE_LEVEL]:i.soundNoiseLevel??o[e.SOUND_NOISE_LEVEL],[e.VHS_GLITCHES]:i.vhsGlitches??o[e.VHS_GLITCHES],[e.GLITCH_PHASE_LEVEL]:i.glitchPhaseLevel??o[e.GLITCH_PHASE_LEVEL],[e.GLITCH_NOISE_LEVEL]:i.glitchNoiseLevel??o[e.GLITCH_NOISE_LEVEL],[e.SCANLINE]:i.scanline,[e.VIGNETTE]:i.vignette,[e.CURVATURE]:i.curvature,[e.GLOW]:i.glow}}saveAndBroadcast(t,i){const n=this._buildStoragePayload(t,i);T.set(n,()=>{if(chrome.runtime.lastError)return;const E={...i,soundFilter:n[e.SOUND_FILTER],soundEffectLevel:n[e.SOUND_EFFECT_LEVEL],soundNoiseLevel:n[e.SOUND_NOISE_LEVEL],vhsGlitches:n[e.VHS_GLITCHES],glitchPhaseLevel:n[e.GLITCH_PHASE_LEVEL],glitchNoiseLevel:n[e.GLITCH_NOISE_LEVEL]};C.sendToMessageableTabs({type:u.SET_OPTIONS,options:E,visible:t},l=>{l&&(l.message&&l.message.includes("Receiving end does not exist")||v("Popup: sendMessage to tab failed",l))})})}_cacheElements(){this._enabledEl=this._getElement(s.ENABLED)}_updateStateLabels(){var E,l,L;const t=this._getElement("overlay-label"),i=this._getElement("sound-label"),n=this._getElement("glitches-label");t&&(t.textContent=(E=this._enabledEl)!=null&&E.checked?"OVERLAY: ON":"OVERLAY: OFF"),i&&(i.textContent=(l=this._getElement(s.SOUND_FILTER))!=null&&l.checked?"VHS SOUND: ON":"VHS SOUND: OFF"),n&&(n.textContent=(L=this._getElement(s.VHS_GLITCHES))!=null&&L.checked?"VHS GLITCHES: ON":"VHS GLITCHES: OFF")}loadFromStorage(){T.get(I,t=>{this._enabledEl&&(this._enabledEl.checked=!!t[e.ENABLED]);const i=this._getElement(s.SOUND_FILTER);i&&(i.checked=!!t[e.SOUND_FILTER]);const n=this._getElement(s.SOUND_EFFECT_LEVEL);n&&t[e.SOUND_EFFECT_LEVEL]!=null&&(n.value=t[e.SOUND_EFFECT_LEVEL]);const E=this._getElement(s.SOUND_NOISE_LEVEL);E&&t[e.SOUND_NOISE_LEVEL]!=null&&(E.value=t[e.SOUND_NOISE_LEVEL]);const l=this._getElement(s.VHS_GLITCHES);l&&(l.checked=!!t[e.VHS_GLITCHES]);const L=this._getElement(s.GLITCH_PHASE_LEVEL);L&&t[e.GLITCH_PHASE_LEVEL]!=null&&(L.value=t[e.GLITCH_PHASE_LEVEL]);const c=this._getElement(s.GLITCH_NOISE_LEVEL);c&&t[e.GLITCH_NOISE_LEVEL]!=null&&(c.value=t[e.GLITCH_NOISE_LEVEL]),d.forEach(a=>{const S=g[a],r=this._sliderIdsByOption[S],N=r?this._getElement(r):null;N&&t[a]!=null&&(N.value=t[a])}),this._updateTrackFills(),this._updateStateLabels()})}bindEvents(){var t,i,n;(t=this._enabledEl)==null||t.addEventListener("change",()=>{this._updateStateLabels(),this.saveAndBroadcast(this._enabledEl.checked,this.getOptionsFromForm())}),(i=this._getElement(s.SOUND_FILTER))==null||i.addEventListener("change",()=>{var E;this._updateStateLabels(),this.saveAndBroadcast(((E=this._enabledEl)==null?void 0:E.checked)??!1,this.getOptionsFromForm())}),[s.SOUND_EFFECT_LEVEL,s.SOUND_NOISE_LEVEL].forEach(E=>{var l;(l=this._getElement(E))==null||l.addEventListener("input",()=>{var L;this._updateTrackFills(),this.saveAndBroadcast(((L=this._enabledEl)==null?void 0:L.checked)??!1,this.getOptionsFromForm())})}),(n=this._getElement(s.VHS_GLITCHES))==null||n.addEventListener("change",()=>{var E;this._updateStateLabels(),this.saveAndBroadcast(((E=this._enabledEl)==null?void 0:E.checked)??!1,this.getOptionsFromForm())}),[s.GLITCH_PHASE_LEVEL,s.GLITCH_NOISE_LEVEL].forEach(E=>{var l;(l=this._getElement(E))==null||l.addEventListener("input",()=>{var L;this._updateTrackFills(),this.saveAndBroadcast(((L=this._enabledEl)==null?void 0:L.checked)??!1,this.getOptionsFromForm())})}),Object.values(this._sliderIdsByOption).forEach(E=>{const l=this._getElement(E);l==null||l.addEventListener("input",()=>{var c;this._updateTrackFills();const L=((c=this._getElement(s.ENABLED))==null?void 0:c.checked)??!1;this.saveAndBroadcast(L,this.getOptionsFromForm())})})}_updateTrackFills(){Object.entries(G).forEach(([t,i])=>{const n=H[t]||{min:0,max:1},E=this._getElement(t),l=this._getElement(i);if(!E||!l)return;const c=((parseFloat(E.value)||n.min)-n.min)/(n.max-n.min)*100;l.style.width=`${Math.max(0,Math.min(100,c))}%`})}init(){this._cacheElements(),this.loadFromStorage(),this.bindEvents(),this._updateTrackFills(),this._updateStateLabels()}}const A=new U;A.init();
