/* CRT overlay – full document size (width/height set by JS), composited layer */
#crt-overlay-root {
  --crt-z-index: 2147483646;
  position: fixed;
  top: 0;
  left: 0;
  min-width: 100vw;
  min-height: 100vh;
  pointer-events: none;
  z-index: var(--crt-z-index);
  overflow: hidden;
  tabindex: -1;
  display: none;
  contain: layout style paint;
  transform: translateZ(0);
}

#crt-overlay-root[data-visible] {
  display: block;
}

#crt-overlay-root * {
  pointer-events: none;
}

#crt-curve-wrap {
  position: absolute;
  inset: 0;
  overflow: hidden;
  contain: layout paint;
}

#crt-curve-inner {
  position: absolute;
  inset: 0;
  contain: layout paint;
}

/* Wobble applied to body – transform-only so it stays on compositor */
body.crt-body-wobble {
  will-change: transform;
  animation: crt-body-wobble 0.12s ease-in-out infinite;
}

@keyframes crt-body-wobble {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(calc(var(--crt-wobble-px, 1) * 1px)); }
  75% { transform: translateX(calc(var(--crt-wobble-px, 1) * -1px)); }
}

/* Scanlines – repeating gradient */
#crt-scanlines {
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 1px,
    rgba(0, 0, 0, var(--crt-scanline, 0.35)) 1px,
    rgba(0, 0, 0, var(--crt-scanline, 0.35)) 2px
  );
  background-size: 100% 2px;
}

/* Vignette – radial gradient */
#crt-vignette {
  position: absolute;
  inset: 0;
  background: radial-gradient(
    ellipse 70% 70% at 50% 50%,
    transparent 0%,
    transparent 50%,
    rgba(0, 0, 0, var(--crt-vignette, 0.5)) 100%
  );
}

/* Glow – phosphor-style edge bloom (soft light at edges) */
#crt-glow {
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background: radial-gradient(
    ellipse 85% 85% at 50% 50%,
    transparent 40%,
    rgba(200, 220, 255, calc(var(--crt-glow, 0.1) * 0.5)) 70%,
    rgba(180, 200, 255, var(--crt-glow, 0.1)) 100%
  );
  mix-blend-mode: screen;
  opacity: 1;
}

/* Optional chromatic edge glow */
#crt-chromatic {
  position: absolute;
  inset: 0;
  box-shadow: inset 2px 0 20px rgba(255, 0, 0, 0.03),
    inset -2px 0 20px rgba(0, 200, 255, 0.03),
    inset 0 2px 20px rgba(255, 255, 0, 0.02),
    inset 0 -2px 20px rgba(0, 255, 100, 0.02);
}

/* VHS RGB chromatic separation – three channels: R left, G center, B right (damaged tape look) */
#crt-vhs-rgb-overlay {
  position: absolute;
  inset: 0;
  display: none;
  pointer-events: none;
  overflow: hidden;
}

#crt-vhs-rgb-red,
#crt-vhs-rgb-green,
#crt-vhs-rgb-cyan {
  position: absolute;
  inset: 0;
  mix-blend-mode: screen;
  opacity: var(--crt-rgb-opacity, 0.5);
}

#crt-vhs-rgb-red {
  background: rgba(255, 0, 50, 0.35);
  transform: translateX(calc(var(--crt-rgb-px, 6) * -1px));
}

#crt-vhs-rgb-green {
  background: rgba(0, 255, 80, 0.2);
  transform: translateX(0);
}

#crt-vhs-rgb-cyan {
  background: rgba(0, 160, 255, 0.35);
  transform: translateX(calc(var(--crt-rgb-px, 6) * 1px));
}

/* VHS rewind texture – fast diagonal stripes (tape rewind / FF look); opacity from slider */
#crt-vhs-rewind {
  position: absolute;
  inset: 0;
  display: none;
  pointer-events: none;
  overflow: hidden;
  opacity: var(--crt-rewind, 0.4);
}

#crt-vhs-rewind::before {
  content: "";
  position: absolute;
  inset: -50%;
  width: 200%;
  height: 200%;
  background: repeating-linear-gradient(
    125deg,
    transparent 0px,
    transparent 2px,
    rgba(0, 0, 0, 0.12) 2px,
    rgba(0, 0, 0, 0.12) 4px,
    transparent 4px,
    transparent 6px,
    rgba(255, 255, 255, 0.03) 6px,
    rgba(255, 255, 255, 0.03) 8px
  );
  background-size: 24px 24px;
  animation: crt-rewind-scroll 0.4s linear infinite;
}

@keyframes crt-rewind-scroll {
  0% { transform: translateY(0) translateX(0); }
  100% { transform: translateY(24px) translateX(9px); }
}

/* VHS glitches: phase (color fringing / chroma shift) – only visible when data-glitches */
#crt-glitch-phase {
  position: absolute;
  inset: 0;
  opacity: 0;
  mix-blend-mode: screen;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 0, 80, 0.15) 20%,
    transparent 40%,
    transparent 60%,
    rgba(0, 200, 255, 0.15) 80%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: crt-phase-drift 6s ease-in-out infinite;
}

#crt-overlay-root[data-glitches] #crt-glitch-phase {
  opacity: var(--crt-glitch-phase, 0.35);
}

@keyframes crt-phase-drift {
  0%, 100% { background-position: 0% 0; }
  50% { background-position: 100% 0; }
}

/* VHS tracking lines – horizontal distortion bands that drift (film-like) */
#crt-tracking-lines {
  position: absolute;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 2px,
    rgba(0, 0, 0, 0.4) 2px,
    rgba(0, 0, 0, 0.4) 4px,
    transparent 4px,
    transparent 8px,
    rgba(255, 255, 255, 0.03) 8px,
    rgba(255, 255, 255, 0.03) 10px
  );
  background-size: 100% 120px;
  animation: crt-tracking-drift 4s linear infinite;
}

#crt-overlay-root[data-glitches] #crt-tracking-lines {
  opacity: var(--crt-tracking-lines, 0.6);
}

@keyframes crt-tracking-drift {
  0% { background-position: 0 0; }
  100% { background-position: 0 120px; }
}

/* VHS head-switching bars – horizontal distortion band (worn tape look) */
#crt-headswitch {
  position: absolute;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    0deg,
    transparent 0px,
    transparent 48px,
    rgba(0, 0, 0, 0.35) 48px,
    rgba(0, 0, 0, 0.35) 52px,
    rgba(255, 255, 255, 0.04) 52px,
    rgba(255, 255, 255, 0.04) 56px,
    transparent 56px,
    transparent 120px
  );
  background-size: 100% 120px;
  animation: crt-headswitch-drift 3.2s linear infinite;
}

#crt-overlay-root[data-glitches] #crt-headswitch {
  opacity: var(--crt-headswitch, 0.25);
}

@keyframes crt-headswitch-drift {
  0% { background-position: 0 0; }
  100% { background-position: 0 120px; }
}

/* VHS glitches: video noise (canvas) */
#crt-glitch-noise-wrap {
  position: absolute;
  inset: 0;
  display: none;
  pointer-events: none;
}

#crt-overlay-root[data-glitches] #crt-glitch-noise-wrap {
  display: block;
}

#crt-glitch-noise {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: fill;
  image-rendering: crisp-edges;
  opacity: var(--crt-glitch-noise, 0.15);
  transform: translateZ(0);
}

/* VHS tape dropouts – random horizontal dark lines (worn tape) */
#crt-glitch-dropout-wrap {
  position: absolute;
  inset: 0;
  display: none;
  pointer-events: none;
}

#crt-glitch-dropout {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: fill;
  transform: translateZ(0);
}
